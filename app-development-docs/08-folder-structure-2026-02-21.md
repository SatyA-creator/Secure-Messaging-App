# 08 — Folder Structure
**Date:** 2026-02-21
**Author:** Engineering Team
**Project:** QuChat — Scalable Folder Architecture
**Status:** Target state (post-Capacitor integration)

---

## 1. Design Principles

1. **Minimal change** — existing `src/` structure is preserved. New files are additions, not relocations.
2. **Platform code is isolated** — all Capacitor/native code lives in `src/lib/platform/` and `src/hooks/`. No platform checks scattered through UI components.
3. **Feature-based grouping** — within `src/components/chat/`, files are grouped by feature, not by platform.
4. **Capacitor at root** — the `android/` folder and `capacitor.config.ts` live at the project root, alongside `vite.config.ts`.

---

## 2. Complete Target Folder Structure

```
messsaging-app/                          ← project root
│
├── android/                             ← GENERATED by Capacitor (don't edit manually)
│   ├── app/
│   │   └── src/main/
│   │       ├── AndroidManifest.xml      ← Edit: permissions, deep link filters
│   │       ├── assets/public/           ← Auto-filled by `npx cap sync`
│   │       └── res/
│   │           ├── mipmap-*/            ← App icons (generated by @capacitor/assets)
│   │           └── drawable-*/          ← Splash screens
│   └── app/build.gradle                 ← Edit: versionCode, versionName, minSdk
│
├── src/                                 ← React app (mostly unchanged)
│   │
│   ├── main.tsx                         ← MODIFIED: Ionic setup + SW registration
│   ├── App.tsx                          ← MODIFIED: platform Router + lifecycle hooks
│   ├── vite-env.d.ts                    ← Unchanged
│   │
│   ├── pages/                           ← UNCHANGED
│   │   ├── Index.tsx
│   │   ├── Auth.tsx
│   │   ├── Chat.tsx
│   │   ├── Settings.tsx
│   │   ├── AcceptInvitation.tsx
│   │   └── NotFound.tsx
│   │
│   ├── context/                         ← UNCHANGED
│   │   ├── AuthContext.tsx
│   │   └── ChatContext.tsx
│   │
│   ├── components/
│   │   ├── ui/                          ← UNCHANGED (shadcn/ui — 50+ files)
│   │   │   ├── button.tsx
│   │   │   ├── dialog.tsx
│   │   │   ├── input.tsx
│   │   │   └── ... (all other ui components)
│   │   │
│   │   ├── auth/                        ← UNCHANGED
│   │   │   ├── LoginForm.tsx
│   │   │   └── RegisterForm.tsx
│   │   │
│   │   ├── chat/                        ← MOSTLY UNCHANGED
│   │   │   ├── ChatWindow.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   ├── ContactList.tsx
│   │   │   ├── MessageInput.tsx         ← MODIFIED: keyboard handling (10 lines)
│   │   │   ├── MessageBubble.tsx
│   │   │   ├── MediaUpload.tsx          ← MODIFIED: use pickMedia() factory (5 lines)
│   │   │   ├── MediaPreview.tsx
│   │   │   ├── ExportConversation.tsx
│   │   │   ├── AddContactDialog.tsx
│   │   │   ├── CreateGroupDialog.tsx
│   │   │   ├── ManageUsers.tsx
│   │   │   ├── ConnectionStatus.tsx
│   │   │   ├── StorageIndicator.tsx
│   │   │   └── InstallPWAButton.tsx     ← NEW: PWA install prompt
│   │   │
│   │   └── hooks/                       ← UNCHANGED
│   │       ├── use-mobile.tsx
│   │       └── use-toast.ts
│   │
│   ├── hooks/                           ← NEW folder (mobile lifecycle)
│   │   ├── useAppLifecycle.ts           ← NEW: Capacitor resume/back/deeplink
│   │   ├── usePWAInstall.ts             ← NEW: beforeinstallprompt handling
│   │   └── useKeyboard.ts               ← NEW: keyboard height tracking
│   │
│   ├── lib/
│   │   ├── cryptoService.ts             ← UNCHANGED
│   │   ├── websocket.ts                 ← UNCHANGED
│   │   ├── localStore.ts                ← UNCHANGED
│   │   ├── relayClient.ts               ← UNCHANGED
│   │   ├── offlineQueue.ts              ← UNCHANGED
│   │   ├── markdownSerializer.ts        ← UNCHANGED
│   │   ├── mediaService.ts              ← UNCHANGED (file upload logic)
│   │   ├── utils.ts                     ← UNCHANGED
│   │   │
│   │   └── platform/                    ← NEW folder (platform abstraction)
│   │       ├── index.ts                 ← NEW: isNative(), isAndroid(), isPWA()
│   │       ├── media.web.ts             ← NEW: web file picker (extracted from MediaUpload)
│   │       ├── media.native.ts          ← NEW: Capacitor camera plugin
│   │       └── mediaFactory.ts          ← NEW: picks correct impl based on platform
│   │
│   ├── config/
│   │   ├── env.ts                       ← UNCHANGED
│   │   └── api.ts                       ← UNCHANGED
│   │
│   ├── types/
│   │   └── messaging.ts                 ← UNCHANGED
│   │
│   └── index.css                        ← MODIFIED: safe-area CSS variables (+10 lines)
│
├── public/                              ← Static assets
│   ├── icons/                           ← NEW: PWA icons
│   │   ├── icon-72x72.png
│   │   ├── icon-96x96.png
│   │   ├── icon-128x128.png
│   │   ├── icon-144x144.png
│   │   ├── icon-192x192.png
│   │   └── icon-512x512.png
│   └── favicon.ico
│
├── assets/                              ← NEW: source assets for icon generation
│   ├── icon-only.png                    ← 1024×1024px icon source
│   ├── icon-background.png              ← 1024×1024px background
│   └── splash.png                       ← 2732×2732px splash source
│
├── backend/                             ← UNCHANGED (FastAPI)
│   ├── app/
│   │   ├── main.py
│   │   ├── api/
│   │   ├── models/
│   │   ├── services/
│   │   └── ...
│   ├── migrations/
│   └── main.py
│
├── app-development-docs/                ← NEW: this documentation
│   ├── 01-project-analysis-2026-02-21.md
│   ├── 02-architecture-plan-2026-02-21.md
│   └── ... (all 10 docs)
│
├── capacitor.config.ts                  ← NEW: Capacitor configuration
├── vite.config.ts                       ← MODIFIED: PWA plugin added
├── index.html                           ← MODIFIED: viewport + PWA meta tags
├── package.json                         ← MODIFIED: new dependencies added
├── tsconfig.json                        ← UNCHANGED
├── tsconfig.app.json                    ← UNCHANGED
├── tailwind.config.js                   ← UNCHANGED
├── postcss.config.js                    ← UNCHANGED
├── .env.production                      ← NEW (or existing — add to .gitignore)
├── .env.development                     ← EXISTING
└── CLAUDE.md                            ← UNCHANGED
```

---

## 3. New Files Summary

| File | Purpose | Size estimate |
|------|---------|--------------|
| `capacitor.config.ts` | Capacitor app config | ~40 lines |
| `src/lib/platform/index.ts` | Platform detection utils | ~15 lines |
| `src/lib/platform/media.web.ts` | Web file picker | ~25 lines |
| `src/lib/platform/media.native.ts` | Capacitor camera | ~35 lines |
| `src/lib/platform/mediaFactory.ts` | Factory function | ~15 lines |
| `src/hooks/useAppLifecycle.ts` | Back button, resume, deep links | ~40 lines |
| `src/hooks/usePWAInstall.ts` | PWA install prompt | ~30 lines |
| `src/hooks/useKeyboard.ts` | Keyboard height tracking | ~30 lines |
| `src/components/chat/InstallPWAButton.tsx` | Install UI button | ~40 lines |
| `public/icons/*.png` | PWA icon set | Binary files |
| `assets/icon-only.png` | Source icon | Binary file |
| `assets/splash.png` | Source splash | Binary file |

**Total new code: ~270 lines across 9 TypeScript files**

---

## 4. Modified Files Summary

| File | What changes | Lines changed |
|------|-------------|--------------|
| `src/App.tsx` | MemoryRouter + lifecycle | ~20 |
| `src/main.tsx` | Ionic setup + SW register | ~15 |
| `index.html` | Viewport + PWA meta | ~10 |
| `src/index.css` | Safe-area variables | ~12 |
| `src/components/chat/MediaUpload.tsx` | Use pickMedia() | ~5 |
| `src/components/chat/MessageInput.tsx` | Keyboard hook | ~10 |
| `vite.config.ts` | VitePWA plugin config | ~65 |
| `android/app/build.gradle` | versionCode etc. | ~5 |
| `android/app/src/main/AndroidManifest.xml` | Permissions | ~10 |
| `backend/.env` | CORS_ORIGINS additions | ~1 |

---

## 5. The `platform/` Folder Contract

Every file in `src/lib/platform/` must follow this contract:

1. **No UI** — platform files never render React components.
2. **Single responsibility** — each file handles one device capability.
3. **Typed interfaces** — all public functions use TypeScript interfaces.
4. **Factory pattern** — `mediaFactory.ts` is the only file imported by UI code.
5. **Graceful web fallback** — every native function has a working web equivalent.

**Future additions to `platform/`:**
```
src/lib/platform/
  notifications.web.ts    ← Web Push API
  notifications.native.ts ← @capacitor/push-notifications (FCM)
  notificationsFactory.ts

  share.web.ts            ← navigator.share() Web Share API
  share.native.ts         ← @capacitor/share
  shareFactory.ts

  storage.web.ts          ← localStorage / IndexedDB
  storage.native.ts       ← @capacitor/filesystem (if needed)
  storageFactory.ts
```

---

## 6. Package.json Dependencies After Integration

**New dependencies to add:**
```json
{
  "dependencies": {
    "@capacitor/core": "^6.0.0",
    "@capacitor/app": "^6.0.0",
    "@capacitor/keyboard": "^6.0.0",
    "@capacitor/status-bar": "^6.0.0",
    "@capacitor/splash-screen": "^6.0.0",
    "@capacitor/camera": "^6.0.0",
    "@ionic/react": "^8.0.0",
    "ionicons": "^7.0.0"
  },
  "devDependencies": {
    "@capacitor/cli": "^6.0.0",
    "@capacitor/android": "^6.0.0",
    "@capacitor/assets": "^3.0.0",
    "vite-plugin-pwa": "^0.20.0"
  }
}
```

All existing dependencies remain unchanged.

---

## 7. `.gitignore` Additions

```gitignore
# Capacitor
android/.gradle/
android/app/build/
android/build/
android/local.properties
android/app/src/main/assets/public/  # generated by cap sync

# Source assets (large binary files — store in LFS or shared drive)
assets/

# Keystores (NEVER commit!)
*.keystore
*.jks
*.p12

# Environment
.env.production
.env.local

# PWA
dist/sw.js
dist/workbox-*.js
```

---

## 8. IDE Configuration (VS Code)

Add to `.vscode/settings.json`:
```json
{
  "files.exclude": {
    "android/.gradle": true,
    "android/build": true,
    "android/app/build": true,
    "android/app/src/main/assets/public": true
  },
  "search.exclude": {
    "android/**": true
  }
}
```

This hides the generated Android files from search and file tree, keeping your workspace clean.
